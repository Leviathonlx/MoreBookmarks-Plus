on_game_start = {
    on_actions = {
        on_game_start_MB
    }
}

on_game_start_MB = {
    effect = {
			set_global_variable = {
			name = MBP_is_loaded
			value = yes
		}
    }
}

yearly_global_pulse = {
	on_actions = {
		on_yearly_assign_culture_faith
		on_persia_struggle_821
	}
}


on_title_gain = {
	on_actions = {
		asdac_on_title_gain
	}
}
asdac_on_title_gain = {
	effect = {
		if = {
			limit = {
				scope:title = {
					tier >= tier_kingdom
				}
				has_nickname = nick_the_black_prince
				this = character:454501
			}
			give_nickname = nick_the_black
		}
		if = {
			limit = {
				#scope:title = { is_holy_order = yes }
				NOT = { has_trait = order_member }
				has_government = holy_order_county_government
			}
			add_trait = order_member
		}
	}
}

on_birth_child = {
	on_actions = {
		asdac_on_birth_child
	}
}
asdac_on_birth_child = {
	effect = {
		if = {
			limit = {
				scope:child = {
					is_female = yes
				}
				scope:father = character:471500
			}
			add_trait = disinherited
		}
	}
}


on_yearly_assign_culture_faith = {
	effect = {
		every_culture_global = {
			if = {
				limit = { has_variable = majority_faith }
				remove_variable = majority_faith
			}

			save_scope_as = current_culture

			every_culture_county = {
				faith = { save_scope_as = county_faith }

				if = {
					limit = {
						scope:current_culture = {
							any_culture_county = {
								percent >= 0.5
								faith = scope:county_faith
							}
						}
					}
					scope:current_culture = {
						set_variable = {
							name = majority_faith
							value = scope:county_faith
						}
					}
				}
			}
		}
	}
}

on_persia_struggle_821 = {
	trigger = {
		game_start_date < 867.1.1  # Paradox auto-start the struggle if you start the game in 867
		current_date < 867.1.1 # No need to check this later
		NOT = { has_global_variable = persia_struggle_821_triggered } # To prevent multiple split (which will not have any effect)
		NOT = { exists = struggle:persian_struggle }
		current_date >= 821.1.1 # Historic year when the Iranian Intermezzo has start
	}
	
	effect = {
		start_struggle = {
			struggle_type = persian_struggle
			start_phase = struggle_persia_phase_stabilisation
		}
	
		set_global_variable = {
			name = persia_struggle_821_triggered
			value = yes
		}
	}
}