#MODIFIED VANILLA EVENTS
#Updated to 1.13

unite_the_southern_slavs_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major
	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 120
		kingdom = 120
		empire = 120
		hegemony = 120
	}
	desc = unite_the_southern_slavs_decision_desc

	is_shown = {
		culture = { has_cultural_pillar = heritage_south_slavic }
		NOT = {
			has_culture = culture:vlach # Not technically Slavic despite being in the South Slavic group.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:unite_the_southern_slavs_decision
			}
		}
	}

	is_valid = {
		culture = { has_cultural_pillar = heritage_south_slavic }
		completely_controls_region = custom_south_slavia #Has de jure Lands
		OR = {
			has_primary_title = title:k_croatia
			has_primary_title = title:k_serbia
			has_primary_title = title:k_bulgaria
			has_primary_title = title:k_dacia
			has_primary_title = title:k_moldavia
			has_primary_title = title:k_bosnia
			has_primary_title = title:k_carinthia							
		}
	}
	
	is_valid_showing_failures_only = {
		is_landed = yes
	}

	effect = {
		gain_heroic_legend_seed_tooltip_effect = yes
		save_scope_as = southern_slav_uniter

		show_as_tooltip = { unite_the_southern_slavs_decision_effects = yes } #Actually applied in east_europe.0006 - prestige, laws, title, innovation effects

		#Events
		trigger_event = east_europe.0005
		every_player = {
			limit = {
				this != scope:southern_slav_uniter
				is_within_diplo_range = { CHARACTER = scope:southern_slav_uniter }
			}
			trigger_event = east_europe.0006
		}

		#Can only be done once
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:unite_the_southern_slavs_decision
		}
		set_global_variable = {
			name = unite_the_southern_slavs_decision
			value = scope:southern_slav_uniter
		}
		set_global_variable = {
			name = unite_the_southern_slavs_decision_title
			value = scope:southern_slav_uniter.primary_title
		}
	}
	

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

#Hungary: historical re-settlement program.
promote_hungarian_settlement_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}

	desc = promote_hungarian_settlement_decision_desc
	selection_tooltip = promote_hungarian_settlement_decision_tooltip
	decision_group_type = major
	ai_goal = yes

	is_shown = {
		is_ruler = yes
		is_playable_character = yes
		game_start_date < 1066.1.1
		culture = { has_cultural_pillar = heritage_magyar }
		NOT = {  #Can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_promoted_hungarian_settlement
			}
		}
		NOT = {  #Can only do either or.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_revived_magyar_paganism
			}
		}
		OR = {
			has_title = title:k_hungary
			has_title = title:e_carpathia
		}
		any_neighboring_top_liege_realm_owner = { #There are same reli neighboring Realms/Empires to take people from.
			religion = religion:christianity_religion
			count >= 2
		}
	}
	
	is_valid = {
		# Must be an Ecumenical Christian
		custom_description = {
  			text = promote_hungarian_settlement_decision_ecumenical_christian
			faith = { #Denomination of Faith must not be a heresy and must have some degree of control over its core regions.
				religion = religion:christianity_religion
				has_doctrine = special_doctrine_ecumenical_christian	
			}
		}
		
		#Must completely control the Carpathian Basin (Hungary De Jure)
		completely_controls = title:k_hungary

		# Capital is Hungarian culture group
		capital_province = { culture = { has_cultural_pillar = heritage_magyar } }
	}

	is_valid_showing_failures_only = {
		is_landed = yes
		is_capable_adult = yes
		is_imprisoned = no
		top_liege = this
		is_at_war = no
	}

	cost = {
		prestige = 2000
		piety = 500
	}

	effect = {
		show_as_tooltip = {
			promote_hungarian_settlement_decision_scripted_effect = yes
		}
		trigger_event = {
			id = east_europe.0030
		}
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_promoted_hungarian_settlement
			}
		}
	}
	
	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 50
		ai_value_modifier = {
			ai_zeal = 1.0
			ai_greed = 1.0
		}
	}
}

#################################
# Found the Kingdom of Bosnia	#
# by Ewan Cowhig Croft			#
#################################
found_kingdom_of_bosnia_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds"
	}
	decision_group_type = major

	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 120
		kingdom = 0
		empire = 0
		hegemony = 0
	}

	desc = found_kingdom_of_bosnia_decision_desc
	selection_tooltip = found_kingdom_of_bosnia_decision_tooltip

	is_shown = {
		is_ruler = yes
		is_playable_character = yes
		exists = dynasty
		OR = {
			#Must be a Serb or Croat within the Bosnian highlands.
			AND = {
				OR = {
					culture = culture:serbian
					culture = culture:croatian
				}
				capital_county = {
					OR = {
						this = title:c_vodica
						this = title:c_pset
						this = title:c_vrbas
						this = title:c_donjikraji
						this = title:c_usora
						this = title:c_rama
						this = title:c_soli
						this = title:c_vhrbosna
						this = title:c_zavrsje
					}
				}
			}
			#Or just be Bosnian.
			culture = culture:bosnian
		}
		NOT = {	#You can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_founded_kingdom_of_bosnia
			}
		}
		NOR = {
			government_has_flag = government_is_mercenary
			government_has_flag = government_is_holy_order
		}
		OR = {
			government_has_flag = government_is_feudal
			government_has_flag = government_is_clan
		}
		highest_held_title_tier <= tier_duchy
	}

	is_valid = {
		#You must have sufficient clout.
		top_liege = this

		#You must control the kingdom's heartlands.
		has_title = title:d_bosna
		has_title = title:d_usora
		completely_controls = title:d_bosna
		completely_controls = title:d_usora

		#You must be sufficiently advanced to conceive of having a separate kingdom, rather than being Croatian or Serbian.
		culture = { has_cultural_era_or_later = culture_era_early_medieval }
	}

	is_valid_showing_failures_only = {
		is_landed = yes
		is_available_adult = yes
	}

	effect = {
		save_scope_as = founder
		show_as_tooltip = { found_kingdom_of_bosnia_decision_scripted_effect = yes }
		gain_heroic_legend_seed_tooltip_effect = yes
		trigger_event = { id = east_europe.0101 }
		#Notify other players.
		every_player = {
			limit = {
				this != scope:founder
				top_liege = {
					OR = {
						this = scope:founder
						any_neighboring_and_across_water_top_liege_realm_owner = { this = scope:founder }
					}
				}
			}
			trigger_event = east_europe.0102
		}
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_founded_kingdom_of_bosnia
			}
			set_global_variable = {
				name = flag_founded_kingdom_of_bosnia
				value = scope:founder
			}
		}
	}

	cost = {
		gold = {
			value = 0
			if = {
				limit = {
					has_treasury = no
				}
				add = 300
			}
		}
		treasury = {
			value = 0
			if = {
				limit = {
					has_treasury = yes
				}
				add = 300
			}
		}
		prestige = 200
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

#################################
# Found the Kingdom of Livonia	#
# by James Beaumont				#
#################################
found_kingdom_of_livonia_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_found_kingdom.dds"
	}
	decision_group_type = major

	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 120
		kingdom = 0
		empire = 0
		hegemony = 0
	}

	desc = found_kingdom_of_livonia_decision_desc
	selection_tooltip = found_kingdom_of_livonia_decision_tooltip

	is_shown = {
		is_ruler = yes
		is_playable_character = yes
		exists = dynasty
		OR = {
			#Must be a Latvian or Christian in Livonia
			AND = {
				NOT = {
					culture = culture:estonian #Estonians already have their Kingdom.
				}
				OR = {
					#Considers themselves to be a "Balt"
					root.culture = { has_cultural_pillar = heritage_baltic }
					root.faith = {
						religion_tag = baltic_religion
					}
					#Is a Crusader founding the Kingdom
					root.faith = {
						NOT = { religion_tag = baltic_religion }
						NOT = { has_doctrine_parameter = unreformed }
					}
				}
				capital_province = {
					geographical_region = ghw_region_baltic
				}
			}
			#Or just be Latvian.
			culture = culture:latgalian
		}
		NOT = {	#You can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_founded_kingdom_of_livonia
			}
		}
		highest_held_title_tier <= tier_duchy
	}

	is_valid = {
		OR = { #Independent or vassal of an Emperor
			top_liege = this
			top_liege.primary_title.tier >= tier_empire
		}
		prestige_level >= medium_prestige_level

		#You must control the kingdom's heartlands.
		has_title = title:d_latgalians
		has_title = title:d_courland
		has_title = title:d_livonia
		has_title = title:d_zemigalia
		has_title = title:d_lettigale					   
		completely_controls_region = custom_latvia
	}

	is_valid_showing_failures_only = {
		is_landed = yes
		is_available_adult = yes
	}

	effect = {
		save_scope_as = founder
		show_as_tooltip = { found_kingdom_of_livonia_decision_scripted_effect = yes }
		gain_heroic_legend_seed_tooltip_effect = yes
		trigger_event = { id = east_europe.0200 }
		#Notify other players.
		every_player = {
			limit = {
				this != scope:founder
				top_liege = {
					OR = {
						this = scope:founder
						any_neighboring_and_across_water_top_liege_realm_owner = { this = scope:founder }
					}
				}
			}
			trigger_event = east_europe.0201
		}
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_founded_kingdom_of_livonia
			}
		}
	}

	cost = {
		gold = {
			value = 0
			if = {
				limit = {
					has_treasury = no
				}
				add = major_gold_value
			}
		}
		treasury = {
			value = 0
			if = {
				limit = {
					has_treasury = yes
				}
				add = major_gold_value
			}
		}
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}


########

historical_orthodox_rus_conversion_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_major_religion.dds"
	}
	decision_group_type = major
	
	#ai_goal = yes
	
	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 120
		kingdom = 120
		empire = 120
		hegemony = 120
	}
	
    desc = historical_orthodox_rus_conversion_decision_desc
	selection_tooltip = historical_orthodox_rus_conversion_decision_tooltip
	
	is_shown = {
		is_ruler = yes
		current_date >= 988.1.1
		OR = { 
			culture = { has_cultural_pillar = heritage_east_slavic }
			culture = { has_cultural_pillar = heritage_north_germanic }
		}
		OR = { 
			has_faith = faith:catholic
			NOT = { religion = religion:christianity_religion }
		}
		#Slavic Paganism must not have been reformed.
		religion:slavic_religion = {
			any_faith = {
				count = all
				has_doctrine = unreformed_faith_doctrine
			}
		}
		#Germanic Paganism must not have been reformed.
		religion:germanic_religion = {
			any_faith = {
				count = all
				has_doctrine = unreformed_faith_doctrine
			}
		}
		OR = {
			has_primary_title = title:k_novgorod
			has_primary_title = title:k_white_rus
			has_primary_title = title:k_ruthenia
			has_primary_title = title:k_bjarmaland
			has_primary_title = title:k_opolye
			has_primary_title = title:k_muscovy
			has_primary_title = title:d_voronezh
			has_primary_title = title:d_martyuba
			has_primary_title = title:d_yedisan
			primary_title = {
				OR = {
					de_jure_liege = title:k_novgorod
					de_jure_liege.de_jure_liege = title:k_novgorod
					de_jure_liege.de_jure_liege.de_jure_liege = title:k_novgorod
					de_jure_liege = title:k_white_rus
					de_jure_liege.de_jure_liege = title:k_white_rus
					de_jure_liege.de_jure_liege.de_jure_liege = title:k_white_rus
					de_jure_liege = title:k_ruthenia
					de_jure_liege.de_jure_liege = title:k_ruthenia
					de_jure_liege.de_jure_liege.de_jure_liege = title:k_ruthenia
					de_jure_liege = title:k_bjarmaland
					de_jure_liege.de_jure_liege = title:k_bjarmaland
					de_jure_liege.de_jure_liege.de_jure_liege = title:k_bjarmaland
					de_jure_liege = title:k_opolye
					de_jure_liege.de_jure_liege = title:k_opolye
					de_jure_liege.de_jure_liege.de_jure_liege = title:k_opolye
					de_jure_liege = title:k_muscovy
					de_jure_liege.de_jure_liege = title:k_muscovy
					de_jure_liege.de_jure_liege.de_jure_liege = title:k_muscovy
					de_jure_liege = title:d_voronezh
					de_jure_liege.de_jure_liege = title:d_voronezh
					de_jure_liege = title:d_martyuba
					de_jure_liege.de_jure_liege = title:d_martyuba
					de_jure_liege = title:d_yedisan
					de_jure_liege.de_jure_liege = title:d_yedisan
				}
			}
		}
		
		NOT = { 
			religion = religion:islam_religion
			religion = religion:judaism_religion
		}
	}
	
	is_valid = {
		is_capable_adult = yes
		OR = {
			faith = { has_doctrine = unreformed_faith_doctrine }
		}
		
	}
	
	is_valid_showing_failures_only = {
		is_landed = yes
		is_imprisoned = no
		is_available_adult = yes
	}
	
	effect = {
        set_character_faith_with_conversion = faith:slavic_orthodox
        if = {
        	limit = { government_has_flag = government_is_clan }
        	change_government = feudal_government
        }
		hidden_effect = {
			primary_title = {
				every_in_de_facto_hierarchy = {
					if = {
						limit = { development_level < 4 }
						change_development_level = 3
					}
				}
			}
		}
    }
	
	cost = {
		piety = 150
		gold = 50
	}

	ai_potential = {
		OR = {
			current_date >= 988.1.1
			has_faith = faith:catholic
		}
	}

	ai_will_do = {
		base = 80
		modifier = {
			factor = 0
			NOT = { has_faith = faith:catholic }
			current_date < 988.1.1
		}
	}
}

form_albania_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major

	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 120
		kingdom = 120
		empire = 120
		hegemony = 120
	}

	desc = form_albania_decision_desc
	selection_tooltip = form_albania_decision_tooltip

	is_shown = {
		is_ruler = yes
		is_playable_character = yes
		exists = dynasty
		#current_date >= 1300.1.1
		OR = {
			OR = {
				culture = culture:arberian
				culture = { has_cultural_pillar = language_albanian }
			}
			#has_primary_title = title:k_sicily
			#has_primary_title = title:k_naples
			#has_primary_title = title:k_trinacria
		}

		NOT = {	#You can only do it once.
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:form_albania_decision
			}
		}
		NOT = { exists = title:k_albania.holder }
		OR = {
			government_has_flag = government_is_feudal
			government_has_flag = government_is_clan
		}
	}

	is_valid = {
		is_independent_ruler = yes
		OR = {
			AND = {
				OR = {
					culture = culture:arberian
					culture = { has_cultural_pillar = language_albanian }
				}
				highest_held_title_tier = tier_duchy
			}
			#has_primary_title = title:k_sicily
			#has_primary_title = title:k_naples
			#has_primary_title = title:k_trinacria
		}
		#You must control the kingdom's heartlands.
		#has_title = title:d_dyrrachion
		completely_controls = title:d_dyrrachion

		#You must be sufficiently advanced to conceive of having a separate kingdom, rather than being Croatian or Serbian.
		#culture = { has_cultural_era_or_later = culture_era_early_medieval }
	}

	is_valid_showing_failures_only = {
		is_landed = yes
		is_available_adult = yes
	}

	effect = {
		save_scope_as = founder
		form_albania_decision_scripted_effect = yes
		#show_as_tooltip = { form_albania_decision_scripted_effect = yes }
		#trigger_event = { id = east_europe.9201 }
		#Notify other players.
		
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:form_albania_decision
			}
		}
	}

	cost = {
		gold = 300
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}