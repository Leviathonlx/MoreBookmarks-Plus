#TGP Travel Events

namespace = tgp_travel_events

# CHINA
# tgp_travel_events.0025 - Family First
# tgp_travel_events.0030 - Roadside Poetry
# tgp_travel_events.0035 - The Root is Weak
# tgp_travel_events.0040 - The Hairs of an Ox
# tgp_travel_events.0045 - Underdeveloped Farming Methods

###########################################
# Family First
# 0025 - 0030
###########################################

scripted_trigger appropriate_interesting_secret = {
	OR = {
		secret_is_always_interesting_trigger = yes
		is_blackmailable_secret_trigger = { BLACKMAILER = scope:event_haver_temp_scope PARTICIPANT = scope:crusty_person }
	NOT = { is_known_by = scope:event_haver_temp_scope }
	}
}
tgp_travel_events.0025 = {
	type = character_event
	title = tgp_travel_events.0025.t
	desc = tgp_travel_events.0025.desc
	theme = travel

	override_background = { reference = wilderness }

	cooldown = { years = 10 }

	left_portrait = {
		character = root
		animation = disbelief
	}

	right_portrait = {
		character = scope:spouse
		animation = boredom
	}

	lower_right_portrait = {
		character = scope:crusty_person
	}

	trigger = {
		has_tgp_dlc_trigger = yes
		root.current_travel_plan = {
			any_entourage_character = {
				is_spouse_of = root
			}
			any_entourage_character = {
				NOT = { is_spouse_of = root }
				OR = {
					is_close_or_extended_family_of = root
					is_councillor_of = root
					is_powerful_vassal_of = root
					is_knight_of = root					
				}
			}
		}
		has_government = celestial_government
		highest_held_title_tier <= tier_empire
		is_available_travelling_adult = yes
		is_location_valid_for_travel_event_on_land = yes
	}

	immediate = {
		save_temporary_scope_as = event_haver_temp_scope
		current_travel_plan = {
			random_entourage_character = {
				limit = { is_spouse_of = root }
				save_scope_as = spouse
			}
			random_entourage_character = {
				limit = {
					NOT = { is_spouse_of = root }
					OR = {
						is_close_or_extended_family_of = root
						is_councillor_of = root
						is_powerful_vassal_of = root
						is_knight_of = root
					}
				}
				save_scope_as = crusty_person
				random_secret = {
					limit = {
						appropriate_interesting_secret = yes
					}
					save_scope_as = secret
				}
			}
		}
	}

	option = { #Anything you wish, my dear.
		name =  tgp_travel_events.0025.a

		scope:spouse = {
			add_opinion = {
				modifier = romance_opinion
				target = root
				opinion = 30
			}
			if = {
				limit = {
					can_set_relation_soulmate_trigger = { CHARACTER = root }
					has_relation_lover = root
				}
				set_relation_soulmate = {
					reason = soulmate_travel_bond
					copy_reason = lover
					target = root
				}
			}
			else_if = {
				limit = {
					can_set_relation_lover_trigger = { CHARACTER = root }
				}
				progress_towards_lover_effect = {
					CHARACTER = root
					REASON = lover_travel_bond
					OPINION = 0
				}
			}
		}
		custom_tooltip = tgp_travel_events.0025.a.tt
		hidden_effect = {
			if = {
				limit = {
					scope:spouse = { has_any_fertility_relationship_with_root_trigger = no }
				}
				set_relation_wedding_good_fertility = scope:spouse
			}
		}

		scope:crusty_person = {
			add_opinion = {
				modifier = angry_opinion
				target = root
				opinion = -30
			}
		}

		stress_impact = {
			content = medium_stress_impact_gain
			compassionate = medium_stress_impact_loss
		}

		ai_chance = {
			base = 100
			
			modifier = {
				factor = 0
				OR = {
					has_relation_soulmate = scope:spouse
					has_relation_lover = scope:spouse
					has_trait = content
				}
			}
			modifier = {
				has_trait = compassionate
				add = 15
			}
		}
	}

	option = { #The meddler is trying to drive a wedge between us!
		name =  tgp_travel_events.0025.b
		flavor = tgp_travel_events.0025.b.flavor

		trigger = {
			exists = scope:secret
		}

		duel = {
			skill = intrigue
			target = scope:crusty_person
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = tgp_travel_events.0025.b.success
				send_interface_toast = {
					title = tgp_travel_events.0025.b.success
					left_icon = root 
					right_icon = scope:crusty_person
					hidden_effect = {
						scope:secret = {
							reveal_to = root
						}
					}
					stress_impact = {
						base = minor_stress_loss
						paranoid = minor_stress_loss
					}
				}
			}
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = tgp_travel_events.0025.b.failure
				send_interface_toast = {
					title = tgp_travel_events.0025.b.failure
					left_icon = root 
					right_icon = scope:crusty_person
					scope:crusty_person = {
						add_opinion = {
							modifier = angry_opinion
							target = root
							opinion = -30
						}
					}
					add_prestige = medium_prestige_loss
					stress_impact = {
						honest = medium_stress_impact_gain
					}
				}
			}
		}
		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_vengefulness = tiny_chance_impact_positive_ai_value
			}
			modifier = {
				has_trait = honest
				factor = 0
			}
			modifier = {
				has_trait = paranoid
				add = 15
			}
		}
	}

	option = { #Darling, you can ride in back.
		name =  tgp_travel_events.0025.c

		change_influence = medium_influence_gain

		scope:spouse = {
			add_opinion = {
				modifier = insulted_opinion
				target = root
				opinion = -25
			}			
		}
		scope:crusty_person = {
			add_opinion = {
				modifier = pleased_opinion
				target = root
				opinion = 25
			}
		}

		stress_impact = { zealous = medium_stress_impact_loss }

		ai_chance = {
			base = 100
			ai_value_modifier = { ai_zeal = tiny_chance_impact_positive_ai_value }
		}
	}

	option = { #Everyone keeps their position!
		name =  tgp_travel_events.0025.d

		scope:spouse = {
			add_opinion = {
				modifier = disappointed_opinion
				target = root
				opinion = -5
			}			
		}
		scope:crusty_person = {
			add_opinion = {
				modifier = disappointed_opinion
				target = root
				opinion = -5
			}
		}
		stress_impact = {
			impatient = medium_stress_impact_loss
		}
		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_energy = tiny_chance_impact_positive_ai_value
				ai_greed = tiny_chance_impact_positive_ai_value
			}
			modifier = {
				has_trait = impatient
				add = 15
			}
		}		
	}
}

###########################################
# Roadside Poetry
# 0030 - 0035
###########################################

tgp_travel_events.0030 = {
	type = character_event
	title = tgp_travel_events.0030.t
	desc = {
		desc = tgp_travel_events.0030.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					has_lifestyle = wanderer_lifestyle
				}
				desc = tgp_travel_events.0030.desc.wanderer_poem
			}
			triggered_desc = {
				trigger = {
					has_lifestyle = diplomacy_lifestyle
				}
				desc = tgp_travel_events.0030.desc.diplomacy_poem
			}
			triggered_desc = {
				trigger = {
					has_lifestyle = martial_lifestyle
				}
				desc = tgp_travel_events.0030.desc.martial_poem
			}
			triggered_desc = {
				trigger = {
					has_lifestyle = stewardship_lifestyle
				}
				desc = tgp_travel_events.0030.desc.stewardship_poem
			}
			triggered_desc = {
				trigger = {
					has_lifestyle = intrigue_lifestyle
				}
				desc = tgp_travel_events.0030.desc.intrigue_poem
			}
			triggered_desc = {
				trigger = {
					has_lifestyle = learning_lifestyle
				}
				desc = tgp_travel_events.0030.desc.learning_poem
			}
			triggered_desc = {
				desc = tgp_travel_events.0030.desc.fallback
			}
		}
	}
	theme = travel
	override_background = { reference = tgp_crossroad_inn_asia }

	cooldown = { years = 10 }

	left_portrait = {
		character = root
		animation = interested
	}

	trigger = {
		has_tgp_dlc_trigger = yes
		has_government = celestial_government
		is_available_travelling_adult = yes
		is_location_valid_for_travel_event_on_land = yes
		any_special_building_province = {
			"squared_distance(root.location)" <= squared_distance_monstrous
			exists = county
		}
	}

	immediate = {
		random_special_building_province = {
			limit = {
				"squared_distance(root.location)" <= squared_distance_monstrous
				exists = county
			}
			save_scope_as = poem_province
		}
	}

	option = { #Try to glean insights from the poem.
		name =  tgp_travel_events.0030.a

		current_travel_plan ?= {
			delay_travel_plan = { days = 5 }
		}

		duel = {
			skill = learning
			value = medium_skill_rating
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = tgp_travel_events.0030.a.success
				send_interface_toast = {
					title = tgp_travel_events.0030.a.success
					left_icon = root
					if = {
						limit = { has_lifestyle = wanderer_lifestyle }
						add_wanderer_lifestyle_xp = medium_lifestyle_experience
					}
					else_if = {
						limit = { has_lifestyle = diplomacy_lifestyle }
						add_diplomacy_lifestyle_xp = medium_lifestyle_experience
					}
					else_if = {
						limit = { has_lifestyle = martial_lifestyle }
						add_martial_lifestyle_xp = medium_lifestyle_experience
					}
					else_if = {
						limit = { has_lifestyle = stewardship_lifestyle }
						add_stewardship_lifestyle_xp = medium_lifestyle_experience
					}
					else_if = {
						limit = { has_lifestyle = intrigue_lifestyle }
						add_intrigue_lifestyle_xp = medium_lifestyle_experience
					}
					else_if = {
						limit = { has_lifestyle = learning_lifestyle }
						add_learning_lifestyle_xp = medium_lifestyle_experience
					}
					else_if = {
						limit = {
							NOT = { has_trait = lifestyle_traveler }
						}
						add_trait = lifestyle_traveler
						traveler_travel_xp_effect = {
							MIN = 1
							MAX = 3
						}						
					}
					else = {
						traveler_travel_xp_effect = {
							MIN = 3
							MAX = 5
						}
					}

					stress_impact = {
						base = minor_stress_impact_loss
						lazy = medium_stress_impact_gain
						ambitious = minor_stress_impact_loss
					}
				}
			}
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = tgp_travel_events.0030.a.failure
				send_interface_toast = {
					title = tgp_travel_events.0030.a.failure
					left_icon = root
				}
			}
		}
		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_energy = tiny_chance_impact_negative_ai_value
			}
			modifier = {
				factor = 0
				has_trait = ambitious
				has_trait = lazy
			}		
		}
	}

	option = { #What a lovely piece.
		name =  tgp_travel_events.0030.b

		stress_impact = { base = medium_stress_impact_loss }

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_energy = tiny_chance_impact_positive_ai_value
				ai_greed = tiny_chance_impact_positive_ai_value
			}
		}
	}
}

###########################################
# The Root is Weak
# 0035 - 0040
###########################################

tgp_travel_events.0035 = {
	type = character_event
	title = tgp_travel_events.0035.t
	desc = {
		desc = tgp_travel_events.0035.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					location = { terrain = farmlands }
				}
				desc = tgp_travel_events.0035.desc.farmlands
			}
			triggered_desc = {
				trigger = {
					location = { terrain = terraced_hills }
				}
				desc = tgp_travel_events.0035.desc.ricefields
			}
		}
		desc = tgp_travel_events.0035.desc.outro
	}

	theme = travel

	cooldown = { years = 10 }

	left_portrait = {
		character = root
		animation = thinking
	}

	right_portrait = {
		character = scope:farmer_char
		animation = disappointed
	}

	override_effect_2d = {
		trigger = {
			current_season_rainy_season = yes
		}
		reference = rain
	}

	override_effect_2d = {
		trigger = {
			OR = {
				current_season_dry_season = yes
				current_season_summer = yes
			}
		}
		reference = legend_glow
	}

	widget = {
		is_shown = {
			current_season_winter = yes
			location = {
				has_winter_trigger = yes
			}
		}
		gui = "event_window_widget_vfx_snow"
		container = "foreground_shader_vfx_container"		
	}

	trigger = {
		has_tgp_dlc_trigger = yes
		has_government = celestial_government
		is_available_travelling_adult = yes
		is_location_valid_for_travel_event_on_land = yes
		location.county.holder ?= root
		highest_held_title_tier <= tier_kingdom
		is_independent_ruler = no
		location = {
			OR = {
				terrain = terraced_hills
				terrain = farmlands
			}
		}
		days_of_continuous_peace <= 90
		OR = {
			current_season_winter = yes
			current_season_summer = yes
			current_season_rainy_season = yes
		}
	}

	immediate = {
		root.location.county = {
			save_scope_as = farming_county
		}
		#Get appropriate character
		random_pool_character = {
			province = root.location
			limit = { is_available_ai_adult = yes }
			save_scope_as = farmer_char
		}
		if = {
			limit = {
				NOT = { exists = scope:farmer_char }
			}
			create_character = {
				template = generic_peasant_character
				location = root.location
				save_scope_as = farmer_char
			}
		}
	}

	option = { #Stop and help him.
		name =  tgp_travel_events.0035.a
		change_merit = minor_merit_gain

		current_travel_plan ?= {
			delay_travel_plan = { days = 2 }
		}

		stress_impact = {
			base = minor_stress_impact_loss
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = tiny_chance_impact_negative_ai_value
			}			
		}
	}

	option = { #I should improve conditions for my farmers.
		name =  tgp_travel_events.0035.b
		scope:farming_county = {
			add_county_modifier = {
				modifier = tgp_aided_farmers_modifier 
				years = 12
			}
		}

		stress_impact = { diligent = medium_stress_impact_loss }

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_energy = tiny_chance_impact_positive_ai_value
			}
			modifier = {
				has_trait = diligent
				add = 15
			}
		}
	}

	option = { #Nah.
		name =  tgp_travel_events.0035.c
		
		current_travel_plan ?= {
			add_destination_progress = { days = 2 }
		}

		stress_impact = {
			impatient = medium_stress_impact_loss
		}

		ai_chance = {
			base = 100
			modifier = {
				has_trait = impatient
				add = 15
			}
		}
	}
	after = {
		scope:farmer_char = {
			if = {
				limit = {
					is_pool_character = no
				}
				silent_disappearance_effect = yes
			}
		}
	}
}

###########################################
# The Hairs of an Ox
# 0040 - 0045
###########################################

tgp_travel_events.0040 = {
	type = character_event
	title = tgp_travel_events.0040.t
	desc = {
		desc = tgp_travel_events.0040.desc
		first_valid = {
			triggered_desc = {
				trigger = {
					location = { terrain = farmlands }
				}
				desc = tgp_travel_events.0040.desc.farmlands
			}
			triggered_desc = {
				trigger = {
					location = { terrain = terraced_hills }
				}
				desc = tgp_travel_events.0040.desc.ricefields
			}
		}
		desc = tgp_travel_events.0040.desc.outro
	}
	theme = travel

	cooldown = { years = 10 }

	left_portrait = {
		character = root
		animation = thinking
	}

	right_portrait = {
		character = scope:farmer_child
		animation = fear
	}

	lower_right_portrait = {
		character = scope:parent
	}

	trigger = {
		has_tgp_dlc_trigger = yes
		has_government = celestial_government
		is_available_travelling_adult = yes
		is_location_valid_for_travel_event_on_land = yes
		exists = location.county.holder
		location.county.holder = root
		highest_held_title_tier <= tier_kingdom
		is_independent_ruler = no
		location = {
			OR = {
				terrain = terraced_hills
				terrain = farmlands
			}
		}
	}

	immediate = {
		root.location.county = {
			save_scope_as = thieving_county
		}
		#Child needs parents.
		create_character = {
			template = generic_peasant_character
			location = root.location
			gender = female
			age = { 25 27 }

			save_scope_as = child_mother
		}
		create_character = {
			template = generic_peasant_character
			location = root.location
			gender = male
			age = { 29 33 }
			save_scope_as = child_father
			after_creation = { marry = scope:child_mother }
		}
		#Create child character
		create_character = {
			template = generic_peasant_character
			location = root.location
			age = { 12 14 }

			after_creation = {
				random_list = {
					33 = { add_trait = physique_good_2 }
					33 = { add_trait = strong }
					33 = { add_trait = shrewd }
				}			
			}
			mother = scope:child_mother
			father = scope:child_father
			save_scope_as = farmer_child
		}
		#We also need someone to present the child.
		create_character = {
			template = generic_peasant_character
			location = root.location
			age = { 29 50 }
			save_scope_as = upset_farmer
		}
		#Is mentioned parent woman or man? Give appropriate traits to this char.
		if = {
			limit = {
				faith = { has_doctrine = doctrine_gender_equal }
			}
			random_list = {
				50 = {
					scope:child_mother = {
						save_scope_as = parent
					}
				}
				50 = {
					scope:child_father = {
						save_scope_as = parent
					}
				}
			}
		}
		else_if = {
			limit = {
				faith = { has_doctrine = doctrine_gender_female_dominated }
			}
			scope:child_mother = { save_scope_as = parent }
		}
		else_if = {
			limit = {
				faith = { has_doctrine = doctrine_gender_male_dominated }
			}
			scope:child_father = { save_scope_as = parent }
		}
		#Give them the drunkard trait
		scope:parent = { add_trait = drunkard }
	}

	option = { #Execute the parent to set an example.
		name =  tgp_travel_events.0040.a

		change_merit = minor_merit_loss
		scope:thieving_county = {
			add_county_modifier = {
				modifier = tgp_disciplined_farmers_modifier
				years = 12
			}
		}

		scope:parent = {
			death = { 
				death_reason = death_execution 
				killer = root 
			}
		}

		hidden_effect = {
			scope:farmer_child = {
				silent_disappearance_effect = yes
			}
			scope:child_mother = {
				if = {
					limit = {
						NOT = { scope:parent = this }
					}
					silent_disappearance_effect = yes
				}
			}
			scope:child_father = {
				if = {
					limit = {
						NOT = { scope:parent = this }
					}
					silent_disappearance_effect = yes
				}
			}
		}

		stress_impact = {
			base = minor_stress_impact_gain
			callous = medium_stress_impact_loss
			vengeful = medium_stress_impact_loss
			compassionate = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = tiny_chance_impact_negative_ai_value
			}
			modifier = {
				has_trait = compassionate
				factor = 0
			}
		}
	}

	option = { #Have the child work off parent's debt at your court.
		name =  tgp_travel_events.0040.b

		add_courtier = scope:farmer_child
		add_character_flag = child_pays_debt

		#Add hook if player wishes to recruit to court position.
		add_hook = {
			target = scope:farmer_child
			type = obligation_hook
		}
		scope:farmer_child = {
			#Used to track when debt is paid.
			add_character_modifier = {
				modifier = tgp_sworn_service_modifier
				years = 8
			}
			add_character_flag = {
				flag = blocked_from_leaving
				years = 8
			}
		}

		change_merit = minor_merit_gain

		hidden_effect = {
			scope:child_mother = {
				if = {
					limit = {
						NOT = { scope:parent = this }
					}
					silent_disappearance_effect = yes
				}
			}
			scope:child_father = {
				if = {
					limit = {
						NOT = { scope:parent = this }
					}
					silent_disappearance_effect = yes
				}
			}
		}

		stress_impact = {
			base = minor_stress_impact_loss
			compassionate = minor_stress_impact_loss
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_compassion = tiny_chance_impact_positive_ai_value
			}
		}
	}

	option = { #Move on.
		name =  tgp_travel_events.0040.c

		current_travel_plan ?= {
			add_destination_progress = { days = 2 }
		}

		hidden_effect = {
			scope:farmer_child = {
				silent_disappearance_effect = yes
			}
			scope:child_mother = {
				silent_disappearance_effect = yes
			}
			scope:child_father = {
				silent_disappearance_effect = yes
			}
		}

		stress_impact = {
			impatient = medium_stress_impact_loss
		}

		ai_chance = {
			base = 100
			modifier = {
				has_trait = impatient
				add = 15
			}
		}
	}

	after = {
		scope:upset_farmer = {
			silent_disappearance_effect = yes
		}

		if = {
			limit = {
				scope:farmer_child = {
					has_character_modifier = tgp_sworn_service_modifier
				}
			}
			trigger_event = {
				ID = tgp_travel_events.0041
				years = 8
			}
		}
	}
}

#A Debt Repaid
tgp_travel_events.0041 = {
	type = character_event
	title = tgp_travel_events.0041.t
	desc = {
		#Opener
		desc = tgp_travel_events.0041.desc
		#Did the character advance from their position?
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:farmer_child = { has_any_court_position = yes}
				}
				desc = tgp_travel_events.0041.desc.court_position
			}
			triggered_desc = {
				trigger = {
					scope:farmer_child = { is_knight_of = root }
				}
				desc = tgp_travel_events.0041.desc.knight
			}
			triggered_desc = {
				trigger = {
					scope:farmer_child = { has_character_flag = master_of_horse_aptitude }
				}
				desc = tgp_travel_events.0041.desc.stables
			}
			triggered_desc = {
				trigger = {
					scope:farmer_child = { has_character_flag = cupbearer_aptitude }
				}
				desc = tgp_travel_events.0041.desc.kitchens
			}
			triggered_desc = {
				trigger = {
					scope:farmer_child = { has_character_flag = court_poet_aptitude }
				}
				desc = tgp_travel_events.0041.desc.study
			}
			desc = tgp_travel_events.0041.desc.fallback
		}
		#Is the parent still alive?
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:parent = { is_alive = yes }
				}
				desc = tgp_travel_events.0041.desc.alive
			}
			triggered_desc = {
				trigger = {
					scope:parent = { is_alive = no }
				}
				desc = tgp_travel_events.0041.desc.dead
			}
		}
	}

	theme = court

	left_portrait = {
		character = root
		animation = personality_bold
	}
	right_portrait = {
		character = scope:farmer_child
		animation = throne_room_bow_1
	}

	trigger = {
		is_available_adult = yes
		#Check if character who recruited child is still alive.
		has_character_flag = child_pays_debt
		#Check if the farmer character is still alive. 
		scope:farmer_child = { is_alive = yes }
	}

	immediate = {
		save_scope_as = liege
		add_character_flag = free_revoke_cost
		scope:farmer_child = { add_character_flag = no_revoke_opinion_loss }
		if = {
			limit = {
				scope:farmer_child = {
					has_any_court_position = no
					NOT = { is_knight_of = root }
				}
			}
			scope:farmer_child = {
				random_list = {
					33 = {
						trigger = {
							root = {
								highest_held_title_tier = tier_kingdom
								NOT = { employs_court_position = master_of_horse_court_position }
							}
						}
						add_martial_skill = { 6 8 }
						add_character_flag = master_of_horse_aptitude
					}
					33 = {
						trigger = {
							root = {
								highest_held_title_tier = tier_kingdom
								NOT = { employs_court_position = cupbearer_court_position }
							}
						}
						add_diplomacy_skill = { 6 8 }
						add_character_flag = cupbearer_aptitude
					}
					33 = {
						trigger = {
							root = {
								highest_held_title_tier = tier_kingdom
								NOT = { employs_court_position = court_poet_court_position }
							}
						}
						add_learning_skill = { 6 8 }
						add_character_flag = court_poet_aptitude
					}
					33 = {
						trigger = {
							root = {
								highest_held_title_tier < tier_kingdom
								NOT = { employs_court_position = court_tutor_court_position }
							}
						}
						add_learning_skill = { 6 8 }
						add_character_flag = tutor_aptitude
					}
				}
			}
		}
		#Did the child already get a court position? Boost education.
		else = {
			scope:farmer_child = {
				rank_up_education_effect = yes
			}
		}
	}

	option = { #I am sure they will do good back home
		name = tgp_travel_events.0041.a

		scope:farmer_child = {
			#If they have court position, remove it.
			if = {
				limit = {
					has_any_court_position = yes
				}
				fire_specific_court_position_effect = { 
					CHARACTER = scope:farmer_child
					LIEGE = scope:liege
				}
			}
			move_to_pool_at = scope:thieving_county
			add_opinion = {
				modifier = grateful_opinion
				target = root
				opinion = 15
			}
		}

		#Incentivize releasing Courtier.
		scope:thieving_county = {
			add_county_modifier = {
				modifier = tgp_courtly_influence_modifier
				years = 12
			}
		}

		stress_impact = {
			base = medium_stress_impact_loss
			deceitful = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_energy = tiny_chance_impact_positive_ai_value
			}
		}
	}
	option = { #I wish to keep them as Master of Horse.
		name = tgp_travel_events.0041.c

		trigger = {
			scope:farmer_child = {
				has_character_flag = master_of_horse_aptitude
			}
		}

		if = {
			limit = {
				scope:parent = { is_alive = yes }
			}
			remove_treasury_or_gold = tiny_treasury_or_gold_value
			stress_impact = { greedy = minor_stress_impact_gain }
			custom_description_no_bullet = { text = tgp_travel_events.0041.tt_pay }
		}

		scope:farmer_child = {
			add_opinion = {
				modifier = annoyed_opinion
				target = root
				opinion = -10
			}
		}
		appoint_court_position = {
			recipient = scope:farmer_child
			court_position = master_of_horse_court_position
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = tiny_chance_impact_negative_ai_value
			}
			modifier = {
        		treasury_or_gold < tiny_treasury_or_gold_value
        		factor = 0
       		}
		}
	}
	option = { #I wish to keep them as Cup Bearer!
		name = tgp_travel_events.0041.d

		trigger = {
			scope:farmer_child = {
				has_character_flag = cupbearer_aptitude
			}
		}

		if = {
			limit = {
				scope:parent = { is_alive = yes }
			}
			remove_treasury_or_gold = tiny_treasury_or_gold_value
			stress_impact = { greedy = minor_stress_impact_gain }
			custom_description_no_bullet = { text = tgp_travel_events.0041.tt_pay }
		}

		scope:farmer_child = {
			add_opinion = {
				modifier = annoyed_opinion
				target = root
				opinion = -10
			}
		}
		appoint_court_position = {
			recipient = scope:farmer_child
			court_position = cupbearer_court_position
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = tiny_chance_impact_negative_ai_value
			}
			modifier = {
        		treasury_or_gold < tiny_treasury_or_gold_value
        		factor = 0
       		}
		}
	}
	option = { #I wish to keep them as Court Poet!
		name = tgp_travel_events.0041.e

		trigger = {
			scope:farmer_child = {
				has_character_flag = court_poet_aptitude
			}
		}

		if = {
			limit = {
				scope:parent = { is_alive = yes }
			}
			remove_treasury_or_gold = tiny_treasury_or_gold_value
			stress_impact = { greedy = minor_stress_impact_gain }
			custom_description_no_bullet = { text = tgp_travel_events.0041.tt_pay }
		}

		scope:farmer_child = {
			add_opinion = {
				modifier = annoyed_opinion
				target = root
				opinion = -10
			}
		}
		appoint_court_position = {
			recipient = scope:farmer_child
			court_position = court_poet_court_position
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = tiny_chance_impact_negative_ai_value
			}
		}
	}
	option = { #I wish to keep them as tutor!
		name = tgp_travel_events.0041.f

		trigger = {
			scope:farmer_child = {
				has_character_flag = tutor_aptitude
			}
		}

		if = {
			limit = {
				scope:parent = { is_alive = yes }
			}
			remove_treasury_or_gold = tiny_treasury_or_gold_value
			stress_impact = { greedy = minor_stress_impact_gain }
			custom_description_no_bullet = { text = tgp_travel_events.0041.tt_pay }
		}

		scope:farmer_child = {
			add_opinion = {
				modifier = annoyed_opinion
				target = root
				opinion = -10
			}
		}
		appoint_court_position = {
			recipient = scope:farmer_child
			court_position = court_tutor_court_position
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = tiny_chance_impact_negative_ai_value
			}
			modifier = {
        		treasury_or_gold < tiny_treasury_or_gold_value
        		factor = 0
       		}
		}
	}
	option = { #They will remain in my service!
		name = tgp_travel_events.0041.g
		custom_tooltip = tgp_travel_events.0041.g.tt
		#You do not have to pay, since you already paid them for the court position.

		trigger = {
			scope:farmer_child = {
				OR = {
					has_any_court_position = yes
					is_knight_of = root
				}
			}
		}

		scope:farmer_child = {
			add_opinion = {
				modifier = annoyed_opinion
				target = root
				opinion = -10
			}
		}

		stress_impact = {
			honest = medium_stress_impact_gain
			just = medium_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = tiny_chance_impact_positive_ai_value
			}
		}
	}
	after = {
		remove_variable ?= penalized_position
		remove_character_flag = no_revoke_opinion_loss
	}
}

###########################################
# Underdeveloped Farming Methods
# 0045 - 0050
###########################################

tgp_travel_events.0045 = {
	type = character_event
	title = tgp_travel_events.0045.t
	desc = tgp_travel_events.0045.desc
	theme = travel

	cooldown = { years = 10 }

	left_portrait = {
		character = root
		animation = thinking
	}

	trigger = {
		has_tgp_dlc_trigger = yes
		has_government = celestial_government
		is_available_travelling_adult = yes
		is_location_valid_for_travel_event_on_land = yes
		exists = location.county.holder
		location.county.holder = {
			NOT = { this = root }
		}
		location = {
			geographical_region = world_europe
			terrain = farmlands
			NOT = { culture = root.culture }
		}
	}

	immediate = {
		root.location.county = { save_scope_as = foreign_county }
		location.county.holder = { save_scope_as = foreign_ruler }
	}

	option = { #Perhaps I can arrange a trade with their ruler.
		name =  tgp_travel_events.0045.a
		add_short_term_gold = medium_gold_value

		scope:foreign_ruler = {
			add_opinion = {
				modifier = pleased_opinion
				target = root
				opinion = 30
			}
		}

		stress_impact = {	
			greedy = medium_stress_impact_loss
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = tiny_chance_impact_positive_ai_value
			}
		}
	}

	option = { #I can attempt to teach them our ways.
		name =  tgp_travel_events.0045.b
		flavor = tgp_travel_events.0045.b.flavor
		duel = {
			skill = diplomacy
			target = scope:foreign_ruler
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = tgp_travel_events.0045.b.success
				send_interface_toast = {
					title = tgp_travel_events.0045.b.success
					left_icon = root
					culture = {
						change_cultural_acceptance = {
							target = scope:foreign_county.culture
							value = medium_positive_culture_acceptance
							desc = cultural_acceptance_taught_methods
						}
					}
					change_merit = minor_merit_gain
					stress_impact = { zealous = medium_stress_impact_loss }
				}
			}
			50 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = tgp_travel_events.0045.b.failure
				send_interface_toast = {
					title = tgp_travel_events.0045.b.failure
					left_icon = root
					culture = {
						change_cultural_acceptance = {
							target = scope:foreign_county.culture
							value = minor_cultural_acceptance_gain
							desc = cultural_acceptance_taught_methods
						}
					}
				}
			}
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_zeal = tiny_chance_impact_positive_ai_value
			}
		}
	}

	option = { #Move on.
		name =  tgp_travel_events.0045.c

		current_travel_plan ?= {
			add_destination_progress = { days = 2 }
		}

		stress_impact = {
			impatient = medium_stress_impact_loss
		}

		ai_chance = {
			base = 100
			modifier = {
				has_trait = impatient
				add = 15
			}
		}
	}
}
