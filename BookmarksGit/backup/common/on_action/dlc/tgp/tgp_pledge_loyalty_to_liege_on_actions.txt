pledge_loyalty_to_liege_start = {
	effect = {
		switch = {
			trigger = has_trait
			shy = { add_stress = minor_stress_impact_gain }
			arrogant = { add_stress = minor_stress_impact_gain }
		}
		if = {
			limit = { has_variable = pledge_loyalty_to_liege_grace }
			remove_variable = pledge_loyalty_to_liege_grace
		}
		set_variable = {
			name = pledge_loyalty_to_liege_grace
			value = liege
		}
		if = {
			limit = { has_variable = homage_type } # To stop errors
			switch = {
				trigger = var:homage_type
				flag:pledge_loyalty_to_liege_submission = {} #Submission
				flag:pledge_loyalty_to_liege_gold = {} #Gold
				flag:pledge_loyalty_to_liege_hook = {} #Favor
				flag:pledge_loyalty_to_liege_contract = { # Contract
					if = { # Levies
						limit = {
							vassal_contract_obligation_level:feudal_government_levies < vassal_contract_obligation_level:feudal_government_taxes
							vassal_contract_obligation_level_can_be_increased = feudal_government_levies
						}
						set_variable = {
							name = pledge_loyalty_to_liege_contract_type
							value = 0
						}
					}
					else_if = { # Gold
						limit = {
							vassal_contract_obligation_level:feudal_government_taxes < vassal_contract_obligation_level:feudal_government_levies
							vassal_contract_obligation_level_can_be_increased = feudal_government_taxes
						}
						set_variable = {
							name = pledge_loyalty_to_liege_contract_type
							value = 1
						}
					}
					else = {
						if = { # Gold
							limit = { vassal_contract_obligation_level_can_be_increased = feudal_government_taxes }
							set_variable = {
								name = pledge_loyalty_to_liege_contract_type
								value = 1
							}
						}
						else = { # Levies
							set_variable = {
								name = pledge_loyalty_to_liege_contract_type
								value = 0
							}
						}
					}
				}
			} 
		}
	}
}

pledge_loyalty_to_liege_travel_planner_exit = {
	effect = {
		pledge_loyalty_to_liege_refund_and_cleanup_effect = yes
	}
}
