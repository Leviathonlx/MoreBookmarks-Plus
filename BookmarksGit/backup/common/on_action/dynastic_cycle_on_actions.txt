dynastic_cycle_monthly_pulse = {
	effect = {
	}
}
dynastic_cycle_yearly_pulse = {
	effect = {
		if = {
			limit = {
				situation_current_phase = situation_dynastic_cycle_phase_chaos
				any_situation_participant = {
					is_valid_for_legitimacy_change = yes
				}
			}
			every_situation_participant = {
				limit = {
					is_valid_for_legitimacy_change = yes
				}
				# for holding the chinese capital
				if = {
					limit = {
						has_title = title:h_china.title_capital_county
					}
					add_legitimacy = 1
				}
				# for holding any kingdom or higher tier title
				every_held_title = {
					limit = {
						hegemony = title:h_china
						tier >= tier_kingdom
					}
					prev = {
						add_legitimacy = prev.tier
					}
				}
				# for having meritorious court positions
				if = {
					limit = {
						any_court_position_holder = {
							percent >= 0.5
							merit_level >= 6
						}
					}
					add_legitimacy = 1
				}
				# for having meritorious councilors
				if = {
					limit = {
						any_councillor = {
							percent >= 0.5
							merit_level >= 6
						}
					}
					add_legitimacy = 1
				}
				# for having meritorious governors
				if = {
					limit = {
						any_vassal = {
							percent >= 0.5
							is_governor = yes
							merit_level >= 6
						}
					}
					add_legitimacy = 1
				}
			}
		}
		# Based on which movement is in power
		if = {
			limit = {
				situation_top_has_catalyst = catalyst_expansion_movement_yearly
				is_movement_in_power = { MOVEMENT = expansion_movement }
				tgp_dynastic_cycle_yearly_drift_blocked_trigger = yes
			}
			trigger_situation_catalyst = catalyst_expansion_movement_yearly
		}
		if = {
			limit = {
				situation_top_has_catalyst = catalyst_advancement_movement_yearly
				is_movement_in_power = { MOVEMENT = advancement_movement }
				tgp_dynastic_cycle_yearly_drift_blocked_trigger = yes
			}
			trigger_situation_catalyst = catalyst_advancement_movement_yearly
		}
		if = {
			limit = {
				situation_top_has_catalyst = catalyst_conservative_movement_yearly
				is_movement_in_power = { MOVEMENT = conservative_movement }
				tgp_dynastic_cycle_yearly_drift_blocked_trigger = yes
			}
			trigger_situation_catalyst = catalyst_conservative_movement_yearly
		}
		if = {
			limit = {
				situation_top_has_catalyst = catalyst_pro_hegemon_movement_advancement_yearly
				is_movement_in_power = { MOVEMENT = pro_hegemon_movement }
				tgp_dynastic_cycle_yearly_drift_blocked_trigger = yes
				hegemon_favors_advancement_trigger = yes
			}
			trigger_situation_catalyst = catalyst_pro_hegemon_movement_advancement_yearly
		}
		if = {
			limit = {
				situation_top_has_catalyst = catalyst_pro_hegemon_movement_expansion_yearly
				is_movement_in_power = { MOVEMENT = pro_hegemon_movement }
				tgp_dynastic_cycle_yearly_drift_blocked_trigger = yes
				hegemon_favors_expansion_trigger = yes
			}
			trigger_situation_catalyst = catalyst_pro_hegemon_movement_expansion_yearly
		}
		# Update years since imperial examination counter
		title:h_china = {
			save_scope_as = hegemon_title
			if = {
				limit = { exists = holder }
				if = {
					limit = { exists = var:years_since_imperial_examination }
					change_variable = {
						name = years_since_imperial_examination
						add = 1
					}
				}
				else = {
					set_variable = {
						name = years_since_imperial_examination
						value = 0
					}
				}
			}
		}
		# Hegemon time-based catalysts.
		if = {
			limit = { exists = scope:hegemon_title.holder }
			scope:hegemon_title.holder = { save_scope_as = hegemon }
			# STABILITY
			### MaA size
			if = {
				limit = {
					situation_top_has_catalyst = catalyst_hegemon_above_maa_limit_yearly
					scope:hegemon.maa_regiments_count > scope:hegemon.maa_regiments_max_count
				}
				trigger_situation_catalyst = catalyst_hegemon_above_maa_limit_yearly
			}
			else_if = {
				limit = {
					situation_top_has_catalyst = catalyst_hegemon_below_maa_limit_yearly
					scope:hegemon.maa_regiments_count < scope:hegemon.maa_regiments_max_count
				}
				trigger_situation_catalyst = catalyst_hegemon_below_maa_limit_yearly
			}
			# CORRUPTION
			### Natural Disasters
			if = {
				limit = {
					situation_top_has_catalyst = catalyst_hegemon_natural_disaster
				}
				scope:hegemon = {
					every_character_situation = {
						limit = {
							OR = {
								situation_type = natural_disaster_earthquake
								situation_type = natural_disaster_flood
							}
						}
						situation:dynastic_cycle = {
							trigger_situation_catalyst = catalyst_hegemon_natural_disaster
						}
					}
				}
			}
			### Legitimacy/Mandate of Heaven
			# Move towards Instability if you are below legitimacy expectations
			if = {
				limit = {
					situation_top_has_catalyst = catalyst_hegemon_below_legitimacy_yearly
					scope:hegemon = {
						legitimacy_level < dynastic_cycle_legitimacy_expectation
					}
				}
				trigger_situation_catalyst = catalyst_hegemon_below_legitimacy_yearly
			}
			# Move towards Instability if you still have no legitimacy
			if = {
				limit = {
					situation_top_has_catalyst = catalyst_hegemon_mandate_of_heaven_at_0
					scope:hegemon.legitimacy_level < 1
				}
				trigger_situation_catalyst = {
					catalyst = catalyst_hegemon_mandate_of_heaven_at_0
					character = scope:hegemon
				}
			}
			# Move towards Stability if you meet legitimacy expectations
			if = {
				limit = {
					situation_top_has_catalyst = catalyst_hegemon_above_legitimacy_yearly
					scope:hegemon = {
						legitimacy_level >= dynastic_cycle_legitimacy_expectation
					}
					situation:dynastic_cycle ?= {
						trigger_if = {
							limit = {
								OR = {
									situation_current_phase = situation_dynastic_cycle_phase_stability_advancement
									situation_current_phase = situation_dynastic_cycle_phase_stability_expansion
								}
							}
							situation_top_sub_region = {
								phase_takeover_points:situation_dynastic_cycle_phase_instability >= 0
							}
						}
						trigger_else_if = {
							limit = {
								OR = {
									situation_current_phase = situation_dynastic_cycle_phase_instability_conquest
									situation_current_phase = situation_dynastic_cycle_phase_instability
								}
							}
							situation_top_sub_region = {
								phase_takeover_points:situation_dynastic_cycle_phase_chaos >= 0
							}
						}
						trigger_else = {
							always = yes
						}
					}
				}
				trigger_situation_catalyst = catalyst_hegemon_above_legitimacy_yearly
			}
			### Hegemon holds FAR too few de jure lands (similar to loss of mandate)
			if = {
				limit = {
					situation_top_has_catalyst = catalyst_hegemony_far_too_few_lands
					scope:hegemon_title = {
						any_de_jure_county = {
							percent < catalyst_hegemony_far_too_few_lands_value
							holder.top_liege = scope:hegemon
						}
					}
				}
				trigger_situation_catalyst = catalyst_hegemony_far_too_few_lands
			}
			### Hegemon holds too few de jure lands
			if = {
				limit = {
					situation_top_has_catalyst = catalyst_hegemony_too_few_lands
					scope:hegemon_title = {
						any_de_jure_county = {
							percent < catalyst_hegemony_too_few_lands_value
							holder.top_liege = scope:hegemon
						}
					}
				}
				trigger_situation_catalyst = catalyst_hegemony_too_few_lands
			}
			### Examinations
			if = {
				limit = {
					situation_top_has_catalyst = catalyst_imperial_examinations_gap_short_yearly
					years_from_game_start >= 6
					exists = scope:hegemon_title.var:years_since_imperial_examination
					scope:hegemon_title.var:years_since_imperial_examination >= catalyst_imperial_examinations_gap_short_yearly_value
				}
				trigger_situation_catalyst = catalyst_imperial_examinations_gap_short_yearly
			}
			if = {
				limit = {
					situation_top_has_catalyst = catalyst_imperial_examinations_gap_long_yearly
					years_from_game_start >= 6
					exists = scope:hegemon_title.var:years_since_imperial_examination
					scope:hegemon_title.var:years_since_imperial_examination >= catalyst_imperial_examinations_gap_long_yearly_value
				}
				trigger_situation_catalyst = catalyst_imperial_examinations_gap_long_yearly
			}
			### Treasury
			if = {
				limit = {
					situation_top_has_catalyst = catalyst_imperial_treasury_debt
					scope:hegemon = { treasury < 0 }
				}
				trigger_situation_catalyst = catalyst_imperial_treasury_debt
			}
		}
	}
}
