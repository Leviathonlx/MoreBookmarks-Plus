imperial_examination_opening_on_action = {
	effect = {
		involved_activity = {
			every_attending_character = {
				limit = {
					location = involved_activity.activity_location
					trigger_if = {
						limit = { is_ai = yes }
						is_ruler = yes
					}
				}
				if = {
					limit = {
						trigger_if = {
							limit = {
								scope:activity = {
									has_activity_type = activity_imperial_examination
								}
							}
							has_activity_intent = imperial_exam_taker_intent
						}
						trigger_else = {
							has_activity_intent = local_exam_taker_intent
						}
						is_in_guest_subset = { name = entrants }
					}
					trigger_event = imperial_examination.1000
				}
				if = {
					limit = { this = scope:host }
					trigger_event = imperial_examination.1001
				}
				if = {
					limit = {
						OR = {
							has_activity_intent = imperial_exam_support_entrants_intent
							has_activity_intent = local_exam_support_entrants_intent
						}
					}
					trigger_event = imperial_examination.1002
				}
				if = {
					limit = { has_activity_intent = exam_assist_exam_intent }
					trigger_event = imperial_examination.1003
				}
			}
		}
	}
}

imperial_examination_pulse = {
	random_on_action = {
		1 = imperial_examination_assembly_events
		1 = imperial_examination_prep_events
	}
}

imperial_examination_assembly_events = {
	trigger = {
		scope:activity = {
			OR = {
				AND = {
					has_activity_type = activity_imperial_examination
					has_current_phase = imperial_examination_phase_assembly
				}
				AND = {
					has_activity_type = activity_local_examination
					has_current_phase = local_examination_phase_assembly
				}
			}
		}
	}
	random_events = {
		#Emperor
		100 = imperial_examination.1060 #Emperor: A delicious gift
		100 = imperial_examination.1070 #Emperor: A most promising entrant

		#Entrants
		100 = imperial_examination.1020 #Entrant: Meet a fellow entrant
		100 = imperial_examination.1040 #Entrant: Taking in the Sights
		100 = imperial_examination.1050 #Entrant: First Impressions

		#Examiners
		100 = az_examination.0001 #Examiner: You are asked to review and comment on entrants' calligraphy and prose styles
		100 = az_examination.0002 #Examiner: You debate with another attending character
		100 = az_examination.0003 #Examiner: A clumsy entrant is improperly serving tea
		100 = az_examination.0004 #Examiner: You witness an entrant perusing an illicit exam guide
		100 = az_examination.0005 #Examiner: You find a fellow examiner contemplating an ancient verse
		100 = az_examination.0006 #Examiner: You uncover a well-connected entrant

		#Family
		100 = imperial_examination_jay.0010 #Family: You bond with another Entrant's parent
		100 = imperial_examination_jay.0040 #Family: You witness another parent bribing an Examiner
		100 = imperial_examination_jay.0080 #Family: An Examiner trips and falls
		100 = imperial_examination_jay.0110 #Family: A greedy Examiner fishes for a bribe
		100 = imperial_examination_jay.0120 #Family: An Examiner sees promise in your child
		100 = imperial_examination_jay.0170 #Family: An Examiner shows your family favoritism
	}
}

imperial_examination_prep_events = {
	trigger = {
		scope:activity = {
			OR = {
				AND = {
					has_activity_type = activity_imperial_examination
					has_current_phase = imperial_examination_phase_preparation
				}
				AND = {
					has_activity_type = activity_local_examination
					has_current_phase = local_examination_phase_preparation
				}
			}
		}
	}
	random_events = {
		#Emperor
		100 = imperial_examination.2000 #Emperor sneaks out to meet entrants
		100 = imperial_examination.2010 #Emperor seeks out dynasty members
		100 = imperial_examination.2030 #Emperor discovers promising lowborn
		100 = imperial_examination.2040 #One of the examiners is taking bribes...?

		#Entrants
		100 = imperial_examination.4000 #Hire a stand-in to take the exam for you
		100 = imperial_examination.4010 #Bribe Examiner
		100 = imperial_examination.4020 #Stay up studying
		100 = imperial_examination.4030 #Study with a friend
		100 = imperial_examination.4050 #Stay up drinking
		100 = imperial_examination.4060 #Potential Rival
		100 = imperial_examination.4070 #Unsolicited Family Support
		100 = imperial_examination.4080 #Two examiners argue the classics
		100 = imperial_examination.4090 #Bond with examiner
		100 = imperial_examination.4100 #Sneak answers into exam hall
		100 = az_examination.0014 #Examiner praises you
		100 = az_examination.0015 #Family member greets you

		#Examiners
		100 = az_examination.0007 #Examiner: Preparing the Ink for the Examination Scrolls
		100 = az_examination.0008 #Examiner: A Rediscovered Scroll Sparks a Challenge
		100 = az_examination.0009 #Examiner: Clumsy Entrant Spills An Ink Crate
		100 = az_examination.0010 #Examiner: Entrant tries to pass a secret message
		100 = az_examination.0011 #Examiner: A Whispered Seat Swap
		100 = az_examination.0012 #Examiner: A Private Tea Invitation
		100 = az_examination.0013 #Examiner: The Vanishing Scrolls
	}
}

imperial_examination_exam_host_events = {
	trigger = {
		scope:activity = {
			has_activity_type = activity_imperial_examination
			has_current_phase = imperial_examination_phase_examination
		}
	}
	random_events = {
		#Emperor
		100 = imperial_examination.3010 #Entrant caught cheating
		100 = imperial_examination.3020 #Dynasty member failing horribly
		100 = imperial_examination.3030 #Examiner falls asleep during examination?!
	}
}

imperial_examination_exam_on_action = {
	effect = {
		involved_activity = {
			every_attending_character = {
				limit = { location = involved_activity.activity_location }
				if = {
					limit = {
						is_in_guest_subset = { name = entrants }
						trigger_if = {
							limit = {
								scope:activity = {
									has_activity_type = activity_imperial_examination
								}
							}
							has_activity_intent = imperial_exam_taker_intent
						}
						trigger_else = {
							has_activity_intent = local_exam_taker_intent
						}
					}
					trigger_event = imperial_examination.1000
				}
				else_if = {
					limit = { this = scope:host }
					trigger_event = imperial_examination.1001
				}
				else_if = {
					limit = {
						is_in_guest_subset = { name = guests }
					}
					trigger_event = imperial_examination.1002
				}
			}
		}
	}
}


imperial_examination_exam_entrant_events = {
	# Entrants
	random_events = {
		100 = imperial_examination.5000
		100 = imperial_examination.5050
		100 = imperial_examination.5100
		100 = imperial_examination.5150
		100 = imperial_examination.5160
		100 = imperial_examination.5170
		100 = imperial_examination.5200
		100 = imperial_examination.5300
		100 = imperial_examination.5400
	}
}

palace_examination_prep_events = {
	trigger = {
		scope:activity = { has_current_phase = imperial_examination_phase_palace_examination }
	}
	random_events = {
		#Emperor
		100 = imperial_examination.9000 # A great feast
		
		100 = emperor_imperial_examination.100 # In Awe
		100 = emperor_imperial_examination.200 # A Selected Beauty
		100 = emperor_imperial_examination.300 # Heirloom Offering
		100 = emperor_imperial_examination.400 # Reciting the Annals
		100 = emperor_imperial_examination.500 # The Poetry of [Character]
		100 = emperor_imperial_examination.600 # In Good Humor
		100 = emperor_imperial_examination.700 # Silver Gift
		100 = emperor_imperial_examination.800 # A Tribute Eunuch
		100 = emperor_imperial_examination.900 # A Good Servant
		100 = emperor_imperial_examination.1000 # Foreign Talent

		#Entrants
		100 = az_examination.0016 #Examiner gives you consolation
		100 = az_examination.0017 #You find a letter you wrote yourself to yourself
		100 = az_examination.0018 #You find an old entrant
		100 = az_examination.0019 #Disappointed family member
		100 = az_examination.0020 #peer passed and you didn't haha
	}
}
