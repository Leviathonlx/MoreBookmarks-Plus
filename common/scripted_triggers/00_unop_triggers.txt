
#There is currently an issue making all NPC thinking they cannot equip the artifact (https://forum.paradoxplaza.com/forum/threads/game-claims-artifact-is-useless-to-recipient-when-its-not.1583999/)

unop_can_equip_artifact_trigger = {
	trigger_if = {
		limit = {
			$ARTIFACT$ = {
				OR = {
					# child_toy_template
					has_variable = playdate_trinket
					has_variable = miniature_collection_tiny_chest
					has_variable = miniature_collection_tiny_sculpture
					has_variable = miniature_collection_tiny_cabinet
					has_variable = miniature_collection_tiny_throne
					has_variable = miniature_collection_tiny_box
				}
			}
		}
		age < 16
	}
	trigger_else_if = {
		limit = {
			$ARTIFACT$ = {
				OR = {
					# adults_only_template: cuckoldry_psalter
					AND = {
						has_variable = cursed_artifact
						has_variable = ai_to_ai_destroy_in_sieges
						has_artifact_modifier = artifact_monthly_prestige_penalty_modifier
						has_artifact_modifier = artifact_attraction_opinion_negative_1_modifier
					}
					# adults_only_template: chastity_belt
					AND = {
						has_variable = cursed_artifact
						has_variable = ai_to_ai_destroy_in_sieges
						has_artifact_modifier = artifact_fertility_negative_modifier
					}
					# adults_only_template: worm_on_a_string
					AND = {
						has_variable = cursed_artifact
						has_variable = ai_to_ai_destroy_in_sieges
						has_artifact_modifier = artifact_attraction_opinion_negative_2_modifier
						has_artifact_modifier = artifact_child_opinion_1_modifier
					}
				}
			}
		}
		age > 18
	}
	trigger_else_if = {
		limit = {
			$ARTIFACT$ = {
				has_variable = statue_religion
			}
		}
		religion = $ARTIFACT$.var:statue_religion
	}
	trigger_else_if = {
		limit = {
			$ARTIFACT$ = {
				has_variable = saint_bone_faith
			}
		}
		$ARTIFACT$ = { save_temporary_scope_as = artifact }
		saintly_bones_faith_trigger = yes
	}
	trigger_else_if = {
		limit = {
			$ARTIFACT$ = {
				category = court
			}
		}
		has_royal_court = yes
	}
	trigger_else = {
		# For other artifact templates it's currently either always equippable
		# or can_equip is the same as can_benefit
		always = yes
	}
}

unop_player_have_valid_heir_trigger = {
    is_ai = no
    AND = {
        exists = player_heir
        trigger_if = {
            limit = { exists = player_heir }
            player_heir.dynasty = dynasty
        }
    }
}

unop_character_can_be_target_by_harm_events_trigger = {
    OR = {
        # Players.
        AND = {
            has_game_rule = harm_target_player_only
            is_ai = no
        }
        # The AI.
        AND = {
            has_game_rule = harm_target_ai_only
            is_ai = yes
        }
		has_game_rule = harm_target_all
    }
    unop_player_have_valid_heir_trigger = yes
}

#Needs CHARACTER and a DENY_CHASTE flag:yes or flag:no
unop_is_sexually_compatible_with_character = {
	AND = {
		NOT = { has_trait = celibate }
		OR = {
			is_ai = no
			AND = {
				might_cheat_on_partner_trigger = { PARTNER = $CHARACTER$ }
				OR = {
					has_perk = unshackled_lust_perk
					is_attracted_to_gender_of = $CHARACTER$
				}
				#Unop: This is based from freely_accepts_sodomy_with_trigger but with the perk check added
				trigger_if = {
					limit = { relation_with_character_is_sodomy_in_my_or_lieges_faith_trigger = { CHARACTER = $CHARACTER$ } }
					OR = { #Will ignore sodomy consequences (because there are none or they have done this before)
						has_trait = deviant
						has_trait = sodomite
						any_secret = { secret_type = secret_homosexual }
						has_perk = unshackled_lust_perk
					}
				}
				trigger_if = {
					limit = { relation_with_character_is_incestuous_in_my_faith_trigger = { CHARACTER = $CHARACTER$ } }
					OR = {
						has_perk = subtle_desire_perk

						# Based on accepts_incest_with_trigger

						NOT = { is_close_or_extended_family_of = $CHARACTER$ } #Actually no incest here!
						NOT = { is_consort_of = $CHARACTER$ }  #Actually no incest here either!
						is_incestuous_trigger = yes
						has_relation_potential_lover = $CHARACTER$
						has_relation_lover = $CHARACTER$
						has_relation_soulmate = $CHARACTER$
					}
				}
				trigger_if = {
					limit = { $DENY_CHASTE$ = flag:yes }
					NOT = { has_trait = chaste }
				}
			}
		}
	}
}

unop_can_be_warrior_strict_trigger = {
	unop_can_be_combatant_gender_overall_trigger = { ARMY_OWNER = $ARMY_OWNER$ }
	trigger_if = { limit = { $ARMY_OWNER$.culture = { has_cultural_parameter = high_prowess_ignores_knight_restrictions } }
		prowess >= 10
	}
}

unop_can_be_knight_strict_trigger = {
	unop_can_be_warrior_strict_trigger = { ARMY_OWNER = $ARMY_OWNER$ }
	trigger_if = { limit = { $ARMY_OWNER$.culture = { has_cultural_parameter = minimum_prowess_for_knights } }
		prowess >= 12
	}
}

unop_can_be_combatant_gender_overall_trigger = {
	#trigger_if = {  # If is member of the clergy allowed to fight and has the same faith as the army owner
	#	limit = { can_be_combatant_based_on_clergy_fighter_trigger = { ARMY_OWNER = $ARMY_OWNER$ } }
	#	always = yes
	#}
	#trigger_else = {
	#	OR = {
	#		can_be_combatant_based_on_martial_or_faith_custom_trigger = { ARMY_OWNER = $ARMY_OWNER$ }
	#		# Those bypass the Martial & Faith customs on certain conditions
	#		can_be_combatant_based_on_culture_trigger = { ARMY_OWNER = $ARMY_OWNER$ }
	#		can_be_combatant_based_on_exception_trigger = { ARMY_OWNER = $ARMY_OWNER$ } # Special event case or special trait (like Order_Member)
	#	}
	#}
}

unop_can_be_combatant_based_on_exception_trigger = {
	OR = {
		# Event-based special exceptions
		has_character_modifier = ignores_gender_army_rules

		# Order members will always fight (as long as they have the same faith as the army owner => As the army commander SHOULD always be an Order GrandMaster this should always be true)
		AND = {
			has_trait = order_member
			faith = $ARMY_OWNER$.faith
		}
	}
}

unop_can_be_combatant_based_on_culture_trigger = {
	OR = {
		AND = {
			$ARMY_OWNER$ = { culture = { has_cultural_parameter = has_access_to_shieldmaidens } }
			has_trait = shieldmaiden
		}
		AND = {
			$ARMY_OWNER$ = { culture = { has_cultural_parameter = high_prowess_ignores_knight_restrictions } }
			prowess >= 10
		}
	}
}

unop_can_be_combatant_based_on_clergy_fighter_trigger = {
	faith = $ARMY_OWNER$.faith
	OR = {
		has_trait = devoted
		is_clergy = yes
	}
	OR = {
		faith = { has_doctrine_parameter = clergy_can_fight }
		culture = { has_cultural_parameter = culture_clergy_can_fight }
	}
}

unop_can_be_combatant_based_on_martial_or_faith_custom_trigger = {
	trigger_if = { # Has the Royal Court and thus can modify pillars
		limit = {
			has_dlc_feature = diverge_culture # Can modify pillars
		}
		custom_description = {
			text = "can_be_combatant_based_on_martial_custom"
			object = this
			subject = $ARMY_OWNER$
			OR = {
				$ARMY_OWNER$ = { culture = { has_cultural_parameter = martial_custom_equal_combatant } }
				AND = {
					$ARMY_OWNER$ = { culture = { has_cultural_parameter = martial_custom_male_only_combatant } }
					is_male = yes
				}
				AND = {
					$ARMY_OWNER$ = { culture = { has_cultural_parameter = martial_custom_female_only_combatant } }
					is_female = yes
				}
			}
		}
	}
	trigger_else = { # Does not have the Royal Court and thus combatant is governed by faith
		custom_description = {
			text = "can_be_combatant_based_on_faith_custom"
			object = this
			subject = $ARMY_OWNER$
			OR = {
				$ARMY_OWNER$ = { faith = { has_doctrine_parameter = combatant_can_be_either_gender_if_no_roco } }
				AND = {
					$ARMY_OWNER$ = { faith = { has_doctrine_parameter = combatant_must_be_male_if_no_roco } }
					is_male = yes
				}
				AND = {
					$ARMY_OWNER$ = { faith = { has_doctrine_parameter = combatant_must_be_female_if_no_roco } }
					is_female = yes
				}
			}
		}
	}
}

unop_is_available_travelling_child = {
	OR = {
		is_available_travelling = yes
		is_available_child = yes
	}
	is_adult = no
}

unop_has_any_relation = {
	OR = {
		has_relation_friend = $TARGET$
		has_relation_best_friend = $TARGET$
		has_relation_rival = $TARGET$
		has_relation_nemesis = $TARGET$
		has_relation_mentor = $TARGET$
		has_relation_student = $TARGET$
		has_relation_lover = $TARGET$
		has_relation_soulmate = $TARGET$
		has_relation_guardian = $TARGET$
		has_relation_ward = $TARGET$
		has_relation_bully = $TARGET$
		has_relation_victim = $TARGET$
		has_relation_crush = $TARGET$
		has_relation_oaf = $TARGET$
		has_relation_soldier_friend = $TARGET$
		has_relation_intrigue_mentor = $TARGET$
		has_relation_intrigue_student = $TARGET$
		has_relation_potential_friend = $TARGET$
		has_relation_potential_rival = $TARGET$
		has_relation_potential_lover = $TARGET$
		has_relation_court_physician = $TARGET$
		has_relation_antiquarian = $TARGET$
		has_relation_wedding_very_bad_fertility = $TARGET$
		has_relation_wedding_bad_fertility = $TARGET$
		has_relation_wedding_good_fertility = $TARGET$
		has_relation_wedding_very_good_fertility = $TARGET$
		has_relation_potential_hook = $TARGET$
		has_relation_activity_recurrer = $TARGET$

		has_secret_relation_intrigue_student = $TARGET$
		has_secret_relation_intrigue_mentor = $TARGET$
		has_secret_relation_oaf = $TARGET$
		has_secret_relation_student = $TARGET$
		has_secret_relation_victim = $TARGET$
		has_secret_relation_rival = $TARGET$
		has_secret_relation_bully = $TARGET$
		has_secret_relation_soulmate = $TARGET$
		has_secret_relation_crush = $TARGET$
		has_secret_relation_guardian = $TARGET$
		has_secret_relation_friend = $TARGET$
		has_secret_relation_best_friend = $TARGET$
		has_secret_relation_court_physician = $TARGET$
		has_secret_relation_soldier_friend = $TARGET$
		has_secret_relation_potential_friend = $TARGET$
		has_secret_relation_potential_lover = $TARGET$
		has_secret_relation_potential_rival = $TARGET$
		has_secret_relation_lover = $TARGET$
	}
}

unop_no_relation = {
	NOR = {
		has_relation_friend = $TARGET$
		has_relation_best_friend = $TARGET$
		has_relation_rival = $TARGET$
		has_relation_nemesis = $TARGET$
		has_relation_mentor = $TARGET$
		has_relation_student = $TARGET$
		has_relation_lover = $TARGET$
		has_relation_soulmate = $TARGET$
		has_relation_guardian = $TARGET$
		has_relation_ward = $TARGET$
		has_relation_bully = $TARGET$
		has_relation_victim = $TARGET$
		has_relation_crush = $TARGET$
		has_relation_oaf = $TARGET$
		has_relation_soldier_friend = $TARGET$
		has_relation_intrigue_mentor = $TARGET$
		has_relation_intrigue_student = $TARGET$
		has_relation_potential_friend = $TARGET$
		has_relation_potential_rival = $TARGET$
		has_relation_potential_lover = $TARGET$
		has_relation_court_physician = $TARGET$
		has_relation_antiquarian = $TARGET$
		has_relation_wedding_very_bad_fertility = $TARGET$
		has_relation_wedding_bad_fertility = $TARGET$
		has_relation_wedding_good_fertility = $TARGET$
		has_relation_wedding_very_good_fertility = $TARGET$
		has_relation_potential_hook = $TARGET$
		has_relation_activity_recurrer = $TARGET$
		has_relation_wet_nurse = $TARGET$
		has_relation_nursed_child = $TARGET$

		has_secret_relation_intrigue_student = $TARGET$
		has_secret_relation_intrigue_mentor = $TARGET$
		has_secret_relation_oaf = $TARGET$
		has_secret_relation_student = $TARGET$
		has_secret_relation_victim = $TARGET$
		has_secret_relation_rival = $TARGET$
		has_secret_relation_bully = $TARGET$
		has_secret_relation_soulmate = $TARGET$
		has_secret_relation_crush = $TARGET$
		has_secret_relation_guardian = $TARGET$
		has_secret_relation_friend = $TARGET$
		has_secret_relation_best_friend = $TARGET$
		has_secret_relation_court_physician = $TARGET$
		has_secret_relation_soldier_friend = $TARGET$
		has_secret_relation_potential_friend = $TARGET$
		has_secret_relation_potential_lover = $TARGET$
		has_secret_relation_potential_rival = $TARGET$
		has_secret_relation_lover = $TARGET$
	}
}

unop_all_counties_have_recent_sighting = {
	any_sub_realm_county = {
		count = all
		has_variable = recent_sighting
	}
}

has_miniscule_renown = {
	trigger_if = {
		limit = { exists = dynasty }
		save_temporary_scope_as = unop_renown_char
		dynasty = { dynasty_prestige >= scope:unop_renown_char.miniscule_dynasty_prestige_value }
	}
	trigger_else = {
		always = no
	}
}

has_minor_renown = {
	trigger_if = {
		limit = { exists = dynasty }
		save_temporary_scope_as = unop_renown_char
		dynasty = { dynasty_prestige >= scope:unop_renown_char.minor_dynasty_prestige_value }
	}
	trigger_else = {
		always = no
	}
}

has_medium_renown = {
	trigger_if = {
		limit = { exists = dynasty }
		save_temporary_scope_as = unop_renown_char
		dynasty = { dynasty_prestige >= scope:unop_renown_char.medium_dynasty_prestige_value }
	}
	trigger_else = {
		always = no
	}
}
