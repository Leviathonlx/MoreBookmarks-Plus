## siro_e_initial_tp_sh
## siro_e_add_tp_sh
## siro_e_revaluate_sh

@TR_VAL = siro_g_sh_val
@TR_VAL_C = siro_g_sh_val_c
@TR_VAL_INTERVAL = siro_v_sh_interval
@TR_VAL_TRUE = siro_v_l_sb_true_val_sh
@BUILDING_1 = siro_b_sh_tp_01
@BUILDING_2 = siro_b_sh_tp_03
@BUILDING_3 = siro_b_sh_tp_04
@BUILDING_4 = siro_b_sh_tp_05
@BUILDING_5 = siro_b_sh_tp_06
@BUILDING_6 = siro_b_sh_tp_07
@TP_VAL_BASE = 0

siro_e_initial_tp_sh = {
##	every_county = {
##		limit = {
##			exists = var:siro_l_ir
##			var:siro_l_ir = { compare_value > 0	} 
##		}
##		add_county_modifier = siro_m_important_route
##	}
	every_county = {
		limit = { 			
			exists = var:siro_l_tp
			exists = var:siro_l_tr_sh
			siro_v_l_sb_true_val_sh = 0 ## there is no trade post
		}
		title_province = {
			if = {
				limit = { 
					not = { has_holding_type = tribal_holding }
					has_free_building_slot = no
				}
				add_building_slot = 1
			}
			if = {
				limit = { has_holding_type = tribal_holding }
				prev = {
					random_county_province = {
						limit = {
							has_holding = no
							or = {
								terrain = floodplains
								terrain = oasis
								terrain = farmlands
							}
							is_coastal = yes
							has_special_building_slot = no
						}
						alternative_limit = {
							has_holding = no
							or = {
								terrain = floodplains
								terrain = oasis
								terrain = farmlands
							}
							has_special_building_slot = no
						}
						alternative_limit = {
							has_holding = no
							or = {
								terrain = floodplains
								terrain = oasis
								terrain = farmlands
							}
						}
						alternative_limit = {
							has_holding = no
						}
						set_holding_type = city_holding
						add_building = @BUILDING_1
					}
				}
			}
			else_if = {
				limit = { 
					not = { has_holding_type = tribal_holding }
					prev.development_level < terrible_development_level
				}
				add_building = @BUILDING_2
			}
			else_if = {
				limit = { 
					not = { has_holding_type = tribal_holding }
					prev.development_level >= terrible_development_level
					prev.development_level < bad_development_level
				}
				add_building = @BUILDING_3
			}
			else_if = {
				limit = { 
					not = { has_holding_type = tribal_holding }
					prev.development_level >= bad_development_level
					prev.development_level < medium_development_level
				}
				add_building = @BUILDING_4
			}
			else_if = {
				limit = { 
					not = { has_holding_type = tribal_holding }
					prev.development_level >= medium_development_level
					prev.development_level < good_development_level
				}
				add_building = @BUILDING_5
			}
			else_if = {
				limit = { 
					not = { has_holding_type = tribal_holding }
					prev.development_level >= good_development_level
				}
				add_building = @BUILDING_6
			}	
		}
	}
	every_county = {
		limit = { siro_v_l_sb_true_val_sh > 0 }
		change_global_variable = {
			name = @TR_VAL
			add = siro_v_l_sb_true_val_sh
		}	
	}
}
		
siro_e_revaluate_sh = {
	county = {
		if = {
			limit = { 
				OR = { 
					NOT = { exists = var:siro_l_tp } 
					var:siro_l_tp = { compare_value = @TP_VAL_BASE }	
				}
			}
			set_variable = {
				name = siro_l_tp
				value = {
					add = @TP_VAL_BASE
					add = @TR_VAL_TRUE
				}
			}
		}
		else = { 
			change_variable = {
				name = siro_l_tp
				add = @TR_VAL_INTERVAL
			}			
			if = {
				limit = { ## prevent cheating
					var:siro_l_tp = { compare_value > @TR_VAL_TRUE }			
				}
				change_global_variable = {
					name = @TR_VAL_C
					subtract = {				
						add = var:siro_l_tp	## subtract old value
						subtract = @TP_VAL_BASE	
						subtract = @TR_VAL_TRUE	## add true value
					}
				}
				set_variable = {
					name = siro_l_tp
					value = {
						add = @TP_VAL_BASE
						add = @TR_VAL_TRUE
					}
				}
			}
			else = {
				change_global_variable = {
					name = @TR_VAL_C
					add = @TR_VAL_INTERVAL
				}
			}
		}
	}
}